<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    
    <title>基于MVVM架构的SEO | n代农</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    
      <link rel="icon" href="/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/js/google-code-prettify/tomorrow-night-eighties.min.css">

  </head>

  <body>

<header>
	<a id="logo" href="/" title="n代农">
	<img src="/favicon.png" alt="n代农"></a>
	
	

	
		<!--侧边导航栏-->
		<a id="nav-toggle" href="#"><span></span></a>

<nav>
	<div class="menu-top-container">
		<ul id="menu-top" class="menu">
			
				
				<li class="current-menu-item">
					<a href="https://www.baidu.com/" target="_blank">baidu</a>
				</li>
			
		</ul>
	</div>
</nav>
	

</header>
<div class="m-header ">
	<section id="hero1" class="hero">
		<div class="inner">
		</div>
	</section>
	
		<figure class="top-image" data-enable=true></figure>
	
</div>

<!--文章列表-->
<div class="wrapper">
  
    <!--文章-->
<article>
	
  
    <h1 class="post-title" itemprop="name">
      基于MVVM架构的SEO
    </h1>
  

	<div class='post-body mb'>
		<p>  &nbsp; &nbsp; 前端的MVVM架构已经发展有一段时间了，MVVM的交互性能高，然而SEO不理想。对于在项目早期的时候，SEO可能并不太重要，毕竟早期项目大多靠百度推广，花点钱就能摆平。但是当项目初具规模，用户数上升，推广费则不可同日而语，这时如何改进和优化SEO就渐渐变得重要了。</p>
<p>SEO的本质即动态页面的静态化，由于前后端分离的开发方式已经是目前最主流的开发方式，Ajax也早已成为web开发中不可缺少的工具，页面都是由前端通过模版结合Ajax动态产生的，而搜索引擎的爬虫是不能够理解js代码的，所以，这种情况下，站点的SEO问题就出来了，爬虫只能爬到静态的模版而不能爬到真正有语义的内容，这当然不是我们所希望看到的。</p>
<p>  &nbsp; &nbsp; 从我调研的SEO优化的结果中看，目前主要有两种方式：</p>
<p>1 后端渲染</p>
<p>SEO不需要针对站点中的所有页面，往往只有个别的页面需要优化，因此可以将这几个页面单独抽离出来让后台生成静态内容返回到前端。这样会有个缺点，这几个页面的重构将脱离MVVM系统，对于大多强迫症患者这点简直难以接受。即使像avalon这样 提供了 后端avalon渲染 的框架来说，目前看仍不成熟，而且从我使用的过程中看，通过 node-avalon 生成的页面需要不断与文件系统交互，因此在性能上我有点担忧。</p>
<p>2 缓存快照</p>
<p>&nbsp; &nbsp; 既然SEO的本质既是让爬虫得到静态话的页面内容，那么当爬虫进入站点的时候，何不缓存一个页面的快照给爬虫呢？更具体一点的实现思路是，当服务端识别到爬虫后，通过转发路由由后台实时生成一个静态页面，再返回给爬虫。而这一切早已有了现成的工具： prerender.io</p>
<p>prerender.io 提供了在线缓存快照的服务，不过目前需要翻墙而且服务也是收费的。如果想在后端搭一个自己的prerender服务也是可以的， prerender 完全开源。</p>
<p>实践中我的项目是nginx + avalon + java的，因此搭好自己的prerender服务后，配置下nginx就ok啦。</p>
<p>下面是在项目中的nginx配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">location / &#123;</div><div class="line">    try_files $uri @prerender;</div><div class="line">       #这里是个坑，root和index均不需要配置</div><div class="line">       #root   /mnt3/zhangx/static/avant_v2-dev/;</div><div class="line">       #index  index.html index.htm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">   location @prerender &#123;</div><div class="line">       # 如果使用第三方prerender.io的服务， 则需要配置token</div><div class="line">       #proxy_set_header X-Prerender-Token o3FCu6FeMLDWG9jcQPBl;</div><div class="line">       set $prerender 0;</div><div class="line">       if ($http_user_agent ~* &quot;baiduspider|twitterbot|facebookexternalhit|rogerbot|linkedinbot|embedly|quora link preview|showyoubot|outbrain|pinterest|slackbot|vkShare|W3C_Validator&quot;) &#123;</div><div class="line">           set $prerender 1;</div><div class="line">       &#125;</div><div class="line">       if ($args ~ &quot;_escaped_fragment_&quot;) &#123;</div><div class="line">           set $prerender 1;</div><div class="line">       &#125;</div><div class="line">       if ($http_user_agent ~ &quot;Prerender&quot;) &#123;</div><div class="line">           set $prerender 0;</div><div class="line">       &#125;</div><div class="line">       if ($uri ~ &quot;\.(js|css|xml|less|png|jpg|jpeg|gif|pdf|doc|txt|ico|rss|zip|mp3|rar|exe|wmv|doc|avi|ppt|mpg|mpeg|tif|wav|mov|psd|ai|xls|mp4|m4a|swf|dat|dmg|iso|flv|m4v|torrent|ttf|woff)&quot;) &#123;</div><div class="line">           set $prerender 0;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       #resolve using Google&apos;s DNS server to force DNS resolution and prevent caching of IPs</div><div class="line">       resolver 8.8.8.8;</div><div class="line"></div><div class="line">       if ($prerender = 1) &#123;</div><div class="line">           #set $prerender &quot;service.prerender.io&quot;;</div><div class="line">           # 这里替换成自己的服务</div><div class="line">           set $prerender &quot;test.meprint.com:3000&quot;;</div><div class="line">           rewrite .* /$scheme://$host$request_uri? break;</div><div class="line">           proxy_pass http://$prerender;</div><div class="line">       &#125;</div><div class="line">       if ($prerender = 0) &#123;</div><div class="line">           root   /mnt3/zhangx/static/avant_v2-dev/;</div><div class="line">           #rewrite .*/index.html break;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
	</div>
	<div class="meta split">
		
			<span>本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次</span>
		
		<time class="post-date" datetime="2017-06-30T09:58:43.000Z" itemprop="datePublished">2017-06-30</time>
	</div>
</article>

<!--评论-->

	
<div class="ds-thread" data-thread-key="基于MVVM架构的SEO" data-title="基于MVVM架构的SEO" data-url="http://wangdashuai.com/2017/06/30/基于MVVM架构的SEO/"></div>
<script type="text/javascript">

var duoshuoQuery = {short_name:"yumemor"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


  
</div>


  <svg id="bigTriangleColor" width="100%" height="40" viewBox="0 0 100 102" preserveAspectRatio="none">
    <path d="M0 0 L50 100 L100 0 Z"></path>
  </svg>

  


  <div class="wrapper"></div>





<div class="fat-footer">
	<div class="wrapper">
		<div class="layout layout--center">
			<div class="layout__item palm-mb">
				<div class="media">
					<img class="headimg" src='http://oct8d1mqf.bkt.clouddn.com/2016-10-17-15%3A42%3A28.jpg' alt='ws'>
					<div class="media__body">
						<h4>n代农</h4>
						<p class='site-description'>null</p>
					</div>
				</div>
				<div class="author-contact">
					<ul>
						
							
							<li>
				        		<a href="null" target="_blank">
				        			
				        		</a>
				        	</li>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<footer class="footer" role="contentinfo">
	<div class="wrapper wrapper--wide split split--responsive">
		
			<span>本站总访问量 <span id="busuanzi_value_site_pv"></span> 次, 访客数 <span id="busuanzi_value_site_uv"></span> 人次</span>
		
		<span>Theme by <a href="http://github.com/yumemor">Yumemor</a>. Powered by <a href="http://hexo.io">Hexo</a></span>
	</div>
</footer>

	<!-－这里导入了 lib.js 里面涵盖了 jQuery 等框架 所以注释掉-->
	<!--<script src="http://lib.sinaapp.com/js/jquery/2.0/jquery.min.js"></script>-->
	<script src="/js/lib.js"></script>
	<script src="/js/google-code-prettify/prettify.js"></script>
	<script src="/js/module.js"></script>
	<script src="/js/script.js"></script>
	
		<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
	<script type='text/javascript'>
		//代码高亮
		$(document).ready(function(){
	 		$('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
   			prettyPrint();
		});
	</script>
	</body>
</html>
